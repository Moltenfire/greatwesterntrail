<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Western Trail</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            font-size: 24px;
        }
    </style>
</head>
<body>

    <h1>Great Western Trail</h1>
    <button onclick="newGame()">New Game</button>
    <div id="buildings"></div>
    <div id="neutral_buildings"></div>
    <div id="bonus_cards"></div>
    <div id="state_value"></div>

    <script src="seedrandom.js"></script>
    <script>

        function splitmix32(a) {
            return function() {
                a |= 0;
                a = a + 0x9e3779b9 | 0;
                let t = a ^ a >>> 16;
                t = Math.imul(t, 0x21f0aaad);
                t = t ^ t >>> 15;
                t = Math.imul(t, 0x735a2d97);
                return ((t = t ^ t >>> 15) >>> 0) / 4294967296;
            }
        }

        const prng = splitmix32((Math.random()*2**32)>>>0);
        const version = 0;

        function getRandomGameState() {
            Math.seedrandom(Date.now());
            let gamestate = {
                buildings: [],
                neutral_buildings: [],
                bonus_cards: [],
            }
            for (let i = 1; i <= 10; i++) {
                gamestate.buildings.push(prng() < 0.5 ? 0 : 1);
            }

            let neutral_buildings = [1, 2, 3, 4, 5, 6, 7];
            for (let i = neutral_buildings.length - 1; i > 0; i--) {
                let j = Math.floor(prng() * (i + 1));
                [neutral_buildings[i], neutral_buildings[j]] = [neutral_buildings[j], neutral_buildings[i]];
            }
            gamestate.neutral_buildings = neutral_buildings;

            let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            for (let i = 0; i < 4; i++) {
                let index = Math.floor(prng() * numbers.length);
                let n = numbers[index];
                gamestate.bonus_cards.push(n);
                numbers.splice(index, 1);
            }
            gamestate.bonus_cards = gamestate.bonus_cards.sort((a, b) => a - b);

            return gamestate;
        }

        function buildingString(state) {
            let results = [];
            for (let i = 0; i < state.buildings.length; i++) {
                let side = state.buildings[i] == 0 ? 'A' : 'B';
                results.push(`${i+1}${side}`);
            }
            return results.join(' ');
        }

        function neutralBuildingString(state) {
            let results = [];
            for (let i = 0; i < state.neutral_buildings.length; i++) {
                results.push(String.fromCharCode(64 + state.neutral_buildings[i]));
            }
            return results.join(' ');
        }

        function bonusCardsString(state) {
            return state.bonus_cards.join(' ');
        }

        function formatNumberAsHex(num, length) {
            return num.toString(16).padStart(length, '0').toUpperCase();
        }

        function stateValue(state) {
            let value = "";

            bonus_cards_value = 0;
            for (let i = 0; i < state.bonus_cards.length; i++) {
                bonus_cards_value |= state.bonus_cards[i] << (4 * i);
            }
            value += formatNumberAsHex(bonus_cards_value, 4);

            neutral_buildings_value = 0;
            for (let i = 0; i < state.neutral_buildings.length; i++) {
                neutral_buildings_value |= state.neutral_buildings[i] << (3 * i);
            }
            value += formatNumberAsHex(neutral_buildings_value, 6);
            
            buildings_value = 0;
            for (let i = 0; i < state.buildings.length; i++) {
                if (state.buildings[i]) {
                    buildings_value |= 1 << i;
                }
            }
            value += formatNumberAsHex(buildings_value), 3;

            value += formatNumberAsHex(version);

            return value;
        }

        function newGame() {
            state = getRandomGameState();
            document.getElementById('buildings').innerText = buildingString(state);
            document.getElementById('neutral_buildings').innerText = neutralBuildingString(state);
            document.getElementById('bonus_cards').innerText = bonusCardsString(state);
            document.getElementById('state_value').innerText = stateValue(state);
        }
    </script>

</body>
</html>